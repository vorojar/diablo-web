# 暗黑破坏神 Web版 (Diablo Web Remake)

这是一个使用 Gemini 3.0 Pro和 Claude code（Kimi k2），完全使用Vibe Coding 模式，不看一行代码开发的。
基于 HTML5 Canvas 和原生 JavaScript 开发的动作角色扮演游戏 (ARPG)，致敬经典的《暗黑破坏神2》。游戏实现了核心的 ARPG 体验，包括随机地牢、装备系统、技能树、任务系统以及实时战斗。

## 🎮 游戏特色

### 核心玩法
- **随机地牢**: 采用 Roguelike 元素的随机地图生成算法，每次进入地牢都是全新的体验。
- **实时战斗**: 流畅的动作战斗系统，支持近战攻击和多种魔法技能。
- **城镇枢纽**: 经典的“罗格营地”作为安全区，包含商人、治疗者和任务 NPC。

### 角色成长
- **属性系统**: 升级获得属性点，可自由分配到力量、敏捷、体力、精力。
- **技能树**:
  - 🔥 **火球术 (Q)**: 发射高伤害的火球，中等射程。
  - ❄️ **冰霜新星 (W)**: 冻结周围敌人，提供控场能力，短程范围。
  - 🏹 **多重射击 (E)**: 发射扇形箭矢，适合群体攻击，远程。
- **等级系统**: 击杀怪物获得经验值，最高等级无上限（软上限取决于怪物经验）。

### 物品与装备
- **装备系统**: 包含头盔、护甲、武器、盾牌/副手、手套、腰带、鞋子、戒指、项链等多个部位。
- **词缀系统**: 装备分为普通(白)、魔法(蓝)、稀有(黄)、暗金(金)四个品质。魔法及以上装备拥有随机词缀（如“残忍的”、“之熊”等），提供额外的属性加成。
- **物品栏**: 经典的网格背包系统（30格），支持物品拖拽、装备和使用。
- **仓库系统**: 私人仓库（36格），可在罗格营地找瓦瑞夫存取物品，与背包互通。
- **腰带系统**: 快捷使用药水和回城卷轴（支持数字键1/2/3快速使用）。
- **赌博与商店**: 可以在基格处购买基础物资，或花费金币进行装备赌博。
- **药剂音效**: 使用治疗/法力药剂时播放逼真的咕噜噜音效。

### 任务系统
- 包含 **10 个章节任务**，从“邪恶洞窟”到“世界之石要塞”。
- 每个任务都有特定的完成条件（如击杀特定 Boss 或清理怪物）和丰厚的奖励（技能点、金币、稀有装备、暗金装备、传奇装备）。
- 任务难度随层数增加，后期任务奖励更珍贵。

### 怪物与战斗系统
- **AI类型**: 近战追击、远程攻击、复活友军（巫师）、任务BOSS。
- **怪物种类**:
  - **沉沦魔** (1-10层): 基础近战怪物
  - **骷髅弓箭手** (2+层): 远程怪物，发射可视箭矢攻击
  - **沉沦魔巫师** (3+层): 可以复活死去的沉沦魔
  - **精英怪** (10%概率): 更强的普通怪物，橙色名称
  - **任务BOSS** (特定层): 血鸟、女伯爵、屠夫、树头木拳、暗黑破坏神、巴尔
- **怪物显示**: 所有怪物显示名称，颜色区分稀有度（Boss红色、精英橙色、普通灰白），血条在怪物头顶。
- **远程战斗**: 骷髅弓箭手射出黄色箭矢，有真实的箭矢飞行轨迹和音效。
- **技能平衡**: 所有技能设置合理射程限制，防止远距离狙击。

### 其他功能
- **自动存档**: 游戏利用 IndexedDB 自动保存角色状态、装备和任务进度。
- **小地图**: 实时显示已探索区域、敌人位置和出入口。
- **音效系统**: 包含背景音乐、战斗音效（支持开关）。
  - 🎵 **背景音乐**: 沉浸式地牢音乐
  - ⚔️ **战斗音效**: 攻击、受伤、火球（逼真三层叠加）、箭矢（风声）、药剂（咕噜噜）
  - 🎊 **特殊音效**: 任务完成、升级、金币拾取
- **背包系统**: 智能背包管理，背包满时点击拾取会显示提示信息。
- **怪物刷新**: 击杀怪物后系统会自动刷新新的怪物，确保地牢始终有挑战。
- **深度难度**: 地牢层数越深，怪物血量和强度越高，提供持续挑战。
- **BOSS掉落**: BOSS和任务怪物掉落更丰厚的奖励，包括多倍金币和2-5件高品质装备。

### 成就系统
游戏包含 **6 个精心设计的成就**，为玩家提供长期目标和挑战：

| 成就名称 | 描述 | 类型 |
| --- | --- | --- |
| 🗡️ **沉沦魔克星** | 击杀1000只沉沦魔 | 击杀类 |
| 🏔️ **地牢征服者** | 到达地牢第10层 | 探索类 |
| 💎 **暗金收藏家** | 收集全套暗金装备 | 收集类 |
| 🛡️ **钢铁意志** | 从未死亡到达第10层 | 挑战类 |
| 👹 **BOSS猎人** | 击败5个首领级敌人 | 击杀类 |
| ⭐ **传奇英雄** | 达到等级30 | 成长类 |

**成就追踪**: 所有成就进度实时追踪，完成后自动获得并播放特殊音效和通知提示。
**成就界面**: 按 `A` 键或点击菜单"成就"按钮查看进度，支持自定义滚动条样式。

## 🕹️ 操作指南

### 键盘控制
| 按键 | 功能 |
| --- | --- |
| `Q` | 释放 火球术 |
| `W` | 释放 冰霜新星 |
| `E` | 释放 多重射击 |
| `1` | 使用腰带第1格物品 (治疗药剂) |
| `2` | 使用腰带第2格物品 (法力药剂) |
| `3` | 使用腰带第3格物品 (回城卷轴) |
| `C` | 打开/关闭 角色属性面板 |
| `I` / `B` | 打开/关闭 物品栏 |
| `T` | 打开/关闭 技能树 |
| `J` | 打开/关闭 任务日志 |
| `A` | 打开/关闭 成就界面 |
| `Enter` | 交互 (进入地牢/传送门/下一层) |
| `Alt` | 显示地面物品标签 (点击标签拾取) |

### 鼠标控制
- **左键点击地面**: 移动角色。
- **左键点击敌人**: 攻击敌人 (按住可持续攻击)。
- **左键点击 NPC**: 对话/交易（基格=商店，阿卡拉=任务/治疗，瓦瑞夫=仓库）。
- **右键点击**: 释放当前选中的技能。
- **物品操作**:
  - 左键点击背包物品：使用或装备（打开仓库时左键=存入仓库）
  - 右键点击背包物品：丢弃物品（仅在非罗格营地）
  - 点击地面掉落物标签：拾取物品
- **技能提示**:
  - 法力不足时会提示需要多少法力
  - 选择未学习的技能时会提示"技能未学习"

## 🛠️ 技术栈

- **前端核心**: HTML5 Canvas API (用于渲染游戏画面和小地图)
- **逻辑实现**: Vanilla JavaScript (ES6+), 无任何第三方库依赖
- **数据存储**: IndexedDB (浏览器本地数据库)
- **样式布局**: CSS3 (Flexbox/Grid 用于 UI 界面)

## 📂 项目结构

```
/
├── index.html      # 游戏主入口，包含所有 HTML 结构、CSS 样式和 JS 逻辑
├── bg.mp3          # 背景音乐文件
└── README.md       # 项目说明文档
```

## 🚀 快速开始

1. **克隆或下载**本项目到本地。
2. 确保目录下有 `bg.mp3` 文件（如果需要背景音乐）。
3. 直接使用现代浏览器（Chrome, Firefox, Edge 等）打开 `index.html` 文件。
4. 点击“踏入庇护所”开始游戏！

> **注意**: 由于使用了 IndexedDB 和部分 ES6 特性，请确保使用最新版本的浏览器。

## 📝 开发日志

- **v1.0**: 基础引擎完成，实现地图生成、移动和碰撞检测。
- **v1.1**: 加入战斗系统、怪物 AI 和掉落系统。
- **v1.2**: 完善 UI，加入物品栏、装备栏和属性面板。
- **v1.3**: 实现任务系统和 NPC 交互。
- **v1.4**: 加入音效系统和存档功能。
- **v1.5**: 新增仓库系统（瓦瑞夫）、右键丢弃物品、技能施放提示、怪物血量随深度增加、BOSS掉落优化、任务数量扩展至10个。
- **v1.6**:
  - **音效优化**: 添加药剂音效（咕噜噜）、优化火球术音效（三层叠加）、新增箭矢音效
  - **游戏平衡**: 为所有技能添加射程限制（火球术中等、冰霜新星短程、多重射击远程）
  - **怪物系统**:
    - 所有怪物显示名称（Boss红色、精英橙色、普通灰白）
    - 优化名称和血条位置，避免遮挡怪物
    - 修复远程怪物攻击自己的bug
    - 骷髅弓箭手发射可视箭矢（黄色线条）并有专属箭矢音效
  - **UI改进**: 技能界面显示射程信息
  - **系统优化**: 背包满时点击拾取物品会显示提示信息（替换原来的alert）
- **v1.7**:
  - **全新成就系统**: 添加6个精心设计的成就
    - 击杀、探索、收集、挑战、成长多种类型
    - 实时进度追踪，完成后自动通知
    - 自定义滚动条样式的美观成就界面
  - **键盘快捷键**: 添加 `A` 键快速打开成就界面
  - **玩家状态追踪**: 新增死亡标记，用于成就判定
  - **存档安全**: 清除存档添加二次确认对话框，显示当前存档信息（等级、位置），防止误操作
  - **UI优化**: 仓库面板位置调整至屏幕右侧，避免遮挡NPC
  - **Bug修复**: 修复仓库面板"一闪而过"的闪烁问题，现在点击瓦瑞夫稳定显示
  - **视觉调整**: 墙壁颜色稍微调亮，改善地牢可见度
- **v1.8**:
  - **游戏机制优化**:
    - 从远处点击物品后，角色会自动移动到物品处并完成捡取（无需二次点击）
    - 法力不足时的提示现在显示在角色上方，而非游戏顶部（更直观）
    - 经验进度条新增百分比显示（精确到小数点后2位）
  - **本地化完善**:
    - 所有属性文本完全本地化（如 Def → 防御，Dmg → 伤害）
    - 物品属性提示现在正确显示中文名称
  - **UI/UX 改进**:
    - 修复物品栏提示有时会被物品栏本身遮挡的层级问题
    - 购买物品时增加金币减少的浮动文字提示
    - 将浮动文字系统改为DOM元素实现，解决被商店等面板遮挡的问题
    - 所有alert弹窗替换为游戏内浮动提示，避免打断游戏流程
  - **游戏平衡调整**:
    - **大幅增强BOSS血量和攻击力**：
      - **血量 (HP)**:
        - 第1个BOSS: 200 → **300** (+50%)
        - 第5层BOSS: 400 → **800** (+100%)
        - 其他BOSS: 基础公式增强为 `(150 + f² × 25) × (1 + f/10)`，第10层BOSS从约1000提升至**4000+**
      - **伤害 (Dmg)**:
        - 第1个BOSS: **25** (原为20)
        - 第5层BOSS: **40** (原为30)
        - 其他BOSS: 20 + f × 3 (原为15 + f × 2)，第10层从35提升至**50**
      - **速度 (Speed)**: 90 + floor/3，随楼层递增
      - **碰撞半径**: 25 → **30** (更容易击中)
      - **经验值**: 1000 + f×200 → **1500 + f×300**
    - 怪物复活时会自动调整位置，确保距离主角150-250像素，避免过近
  - **Bug修复**:
    - 修复可以隔墙物理攻击怪物的问题（增加视线检测）
    - 修复打到怪物时掉血显示浮点数的bug（改为取整显示）
    - 修复第9层打死BOSS暗黑破坏神时卡死的bug（saveGame函数未定义）
    - 捡取物品时如果背包满了，会在角色上方显示红色浮动提示
    - 购买物品时如果背包满了，同样显示浮动提示并返还金币

---
*Stay awhile and listen...*
